/*! @license pzpr.js v3.6.0-pre (c) 2009-2016 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["kramma","kramman","shwolf"],{MouseEvent:{mouseinput:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&(this.btn.Left&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.puzzle.editmode&&(this.mousestart&&"kramma"!==this.pid?this.inputcrossMark():this.mouseend&&this.notInputted()&&this.inputqnum())},inputborder:function(){var a=this.getpos(.35);if(!this.prevPos.equals(a)){var b=this.prevPos.getborderobj(a);if(!b.isnull){null===this.inputData&&(this.inputData=b.isBorder()?0:1);for(var c=b.getlinesize(),d=this.board.borderinside(c.x1,c.y1,c.x2,c.y2),e=0;e<d.length;e++)1===this.inputData?d[e].setBorder():0===this.inputData&&d[e].removeBorder();this.puzzle.painter.paintRange(c.x1-1,c.y1-1,c.x2+1,c.y2+1)}this.prevPos=a}}},KeyEvent:{enablemake:!0},Cell:{numberAsObject:!0,maxnum:2},Cross:{noNum:function(){return null!==this.id&&-1===this.qnum}},Border:{getlinesize:function(){var a=this.getaddr(),b=a.clone();if(this.isVert()){for(;a.move(0,-1).getx().noNum();)a.move(0,-1);for(;b.move(0,1).getx().noNum();)b.move(0,1)}else{for(;a.move(-1,0).getx().noNum();)a.move(-1,0);for(;b.move(1,0).getx().noNum();)b.move(1,0)}return{x1:a.bx,y1:a.by,x2:b.bx,y2:b.by}}},Board:{hascross:1,hasborder:1},"Board@kramma,krammar":{cols:8,rows:8},AreaRoomGraph:{enabled:!0},Graphic:{gridcolor_type:"DLIGHT",bordercolor_func:"qans",borderQanscolor:"rgb(64, 64, 255)",circlefillcolor_func:"qnum2",circlestrokecolor_func:"qnum2",crosssize:.15,paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),"shwolf"!==this.pid?this.drawCircles():this.drawSheepWolf(),"kramma"!==this.pid&&this.drawCrossMarks(),this.drawHatenas(),this.drawBorderQsubs(),this.drawChassis(),this.drawTarget()}},"Graphic@shwolf":{resize_canvas_main:function(){this.imgtile||(this.imgtile=new this.klass.ImageTile),this.common.resize_canvas_main.call(this)},drawSheepWolf:function(){var a=this.vinc("cell_number_image","auto");if(this.imgtile)for(var b=this.range.cells,c=0;c<b.length;c++){var d=b[c],e=["cell",d.id,"quesimg"].join("_"),f=(d.bx-1)*this.bw,g=(d.by-1)*this.bh;this.imgtile.putImage(a,e,d.qnum>0?d.qnum-1:null,f,g,this.cw,this.ch)}}},Encode:{decodePzpr:function(a){"shwolf"!==this.pid&&this.checkpflag("c")?this.decodeCircle():(this.decodeCrossMark(),this.decodeCircle()),"kramma"===this.pid&&this.checkPuzzleid()},encodePzpr:function(a){"kramma"!==this.pid?(this.encodeCrossMark(),this.encodeCircle()):(this.outpflag="c",this.encodeCircle())},checkPuzzleid:function(){for(var a=this.puzzle,b=a.board,c=0;c<b.cross.length;c++)if(1===b.cross[c].qnum){a.changepid("kramman");break}}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCrossNum(),this.decodeBorderAns(),"kramma"===this.pid&&this.puzzle.enc.checkPuzzleid()},encodeData:function(){this.encodeCellQnum(),this.encodeCrossNum(),this.encodeBorderAns()}},AnsCheck:{checklist:["checkBorderBranch@!kramma","checkBorderCrossOnBP@!kramma","checkLcntCurve@!kramma","checkLineChassis@shwolf","checkNoNumber","checkSameObjectInArea","checkBorderDeadend+@!kramma","checkBorderNoneOnBP@kramman"],checkBorderBranch:function(){this.checkBorderCount(3,0,"bdBranch")},checkBorderCrossOnBP:function(){this.checkBorderCount(4,1,"bdCrossBP")},checkBorderNoneOnBP:function(){this.checkBorderCount(0,1,"bdIgnoreBP")},checkSameObjectInArea:function(){this.checkSameObjectInRoom(this.board.roommgr,function(a){return a.getNum()},"bkPlNum")},checkLcntCurve:function(){for(var a=this.board,b=a.crossinside(a.minbx+2,a.minby+2,a.maxbx-2,a.maxby-2),c=0;c<b.length;c++){var d=b[c],e=d.adjborder;if(2===d.lcnt&&1!==d.qnum&&!(1===e.top.qans&&1===e.bottom.qans||1===e.left.qans&&1===e.right.qans)){if(this.failcode.add("bdCurveExBP"),this.checkOnly)break;d.setCrossBorderError()}}},checkLineChassis:function(){for(var a=!0,b=this.board,c=[],d=0;d<b.border.length;d++)c[d]=b.border[d].qans;var e=new this.klass.Address(0,0);for(e.bx=b.minbx;e.bx<=b.maxbx;e.bx+=2)for(e.by=b.minby;e.by<=b.maxby;e.by+=2)(e.bx===b.minbx||e.bx===b.maxbx)!=(e.by===b.minby||e.by===b.maxby)&&(e.by===b.minby?this.clearLineInfo(c,e,2):e.by===b.maxby?this.clearLineInfo(c,e,1):e.bx===b.minbx?this.clearLineInfo(c,e,4):e.bx===b.maxbx&&this.clearLineInfo(c,e,3));for(var d=0;d<b.border.length;d++)if(1===c[d]){if(a=!1,this.checkOnly)break;b.border.filter(function(a){return 1===c[a.id]}).seterr(1)}a||(this.failcode.add("bdNotChassis"),b.border.setnoerr())},clearLineInfo:function(a,b,c){for(var d=[[b.clone(),c]];d.length>0;){var e=d.pop();for(b=e[0],c=e[1];;)if(b.movedir(c,1),b.oncross()){var f=b.getx(),g=f.adjborder;if(!f.isnull&&1===f.qnum){g.top.qans&&d.push([b.clone(),1]),g.bottom.qans&&d.push([b.clone(),2]),g.left.qans&&d.push([b.clone(),3]),g.right.qans&&d.push([b.clone(),4]);break}}else{var h=b.getb();if(h.isnull||0===a[h.id])break;a[h.id]=0}}}},FailCode:{bkNoNum:["白丸も黒丸も含まれない領域があります。","An area has no marks."],bkPlNum:["白丸と黒丸が両方含まれる領域があります。","An area has both white and black circles."],bdBranch:["分岐している線があります。","There is a branch line."],bdCurveExBP:["黒点以外のところで線が曲がっています。","A line curves out of the points."],bdCrossBP:["黒点上で線が交差しています。","There is a crossing line on the point."],bdIgnoreBP:["黒点上を線が通過していません。","A point has no line."]},"FailCode@shwolf":{bkNoNum:["ヤギもオオカミもいない領域があります。","An area has neither sheeps nor wolves."],bkPlNum:["ヤギとオオカミが両方いる領域があります。","An area has both sheeps and wolves."],bdNotChassis:["外枠につながっていない線があります。","A line doesn't connect to the chassis."]},"ImageTile@shwolf":{initialize:function(){pzpr.env.node?this.image=new require("jsdom").jsdom("").defaultView.Image():this.image=new Image,this.image.src=pzpr.env.browser.legacyIE?this.imgsrc_imgfile:this.imgsrc_dataurl,this.image.height=64,this.image.width=128,this.cols=2,this.rows=1,this.cwidth=this.image.width/this.cols,this.cheight=this.image.height/this.rows,this.loaded=!0},imgsrc_dataurl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABABAMAAAAg+GJMAAAAMFBMVEUAAACtAADv97X/a/f//wD///////////////////////////////////////////81EdaHAAAAEHRSTlP///8A////////////////8M8+MgAAAk5JREFUeJzF10FywyAMBdDvuNmTG2RyAmZ8gS56AG96/6sUAYIPCDduOymbJLb1ImSCFWy/HPgzAC2F9STgW8A/BXg0AIeAPGAyz/ilBbi0AH0E7HQ8GMDlDj73IOBmCwgnChAiGuDyuBPgrEkASws86CJcyMMtCEMKPsQTECKOAGMSiIc7QMoiYwv5PBpgmERMgAGJoNEDveBjAg0Q466fMsKbSw90ZfDpIAF3jZaxSw4VWNLF0BlCj7kCyKlPHqDllwHHU9SsFOjjYw5NvWMKi77RpNYMeM6/Eu18aTglFRjDG0G/eXS2BHgY8SKssxRqAgJ4M4FYya4KXXzKXk7b8UFYFTAEp8A0gQqYKeT8MKtAqkK7GscKCDBPgFMwgHzmYAY1Bes+VGAeH1J4AigJIC3oHbSwFTCW0gCAgetJYIcAlPk1HTsE1grA+DHFfPYDwCmAazPrUn9RnwG2uHcM92IHP5IOgfRUHID4S2sA1J0FDORiWkAZEXAfH2knTK8OJwDkwHd5ffspECLfQ6R7S87tPOB0M19+CJhL8e+Abini5YDvge3lAL4HXP5FOOs2vh4AWqBbCHsHxMXHAM4CQhBQW6YZ0HV10sIsBFD7Ud4099FqLEuH4hZqGxnIW2vYDrsaFiED3HaWKz0DuwFob9j1jBXgIpiAPORdLCafpf8VhyVIl8S7p9vpAHCjeQjgCcCMD+2ay/8SLKA2CrME5Ckf62ADmz4hp3+ycpvQ7TX8vjbTk2Gc5k/+u/h0RTu/g6snQlefk8A4/h/4AjUhvQ8aixc0AAAAAElFTkSuQmCC",imgsrc_imgfile:pzpr.util.getpath()+"../img/shwolf_obj.png",putImage:function(a,b,c,d,e,f,g){var h=this.cwidth,i=this.cheight,j=h*(c%this.cols),k=i*(c/this.cols|0);void 0===f&&(f=h,g=i),a.vid=b,a.drawImage(null!==c?this.image:null,j,k,h,i,d,e,f,g)}}});