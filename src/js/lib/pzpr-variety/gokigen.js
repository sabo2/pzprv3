/*! @license pzpr.js v3.6.0-pre (c) 2009-2016 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["gokigen","wagiri"],{MouseEvent:{use:!0,mouseinput:function(){var a=this.puzzle;a.playmode&&this.mousestart?this.inputslash():a.editmode&&this.mousestart&&("gokigen"===a.pid?this.inputcross():"wagiri"===a.pid&&this.inputquestion())},inputslash:function(){var a=this.getcell();if(!a.isnull){var b=this.puzzle.getConfig("use"),c=this.btn.Left?31:32,d=a.qans;1===b?a.setQans(d!==c?c:0):2===b&&a.setQans((this.btn.Left?{0:31,31:32,32:0}:{0:32,31:0,32:31})[d]),a.drawaround()}},dispRed:function(){var a=this.puzzle,b=a.playmode&&a.key.isZ;return b&&this.dispBlue(),b},dispBlue:function(){var a=this.getcell();this.mousereset(),a.isnull||0===a.qans||null===a.path||(this.board.cell.setinfo(-1),a.path.setedgeinfo(2),this.board.haserror=!0,this.puzzle.redraw())}},"MouseEvent@wagiri":{inputquestion:function(){var a=this.getpos(.33);a.isinside()&&(this.cursor.equals(a)?a.oncross()?this.inputcross():a.oncell()&&this.inputwagiri(a):this.setcursor(a))},inputwagiri:function(a){var b=a.getc();if(!b.isnull){var c=this.btn.Left?[-1,1,0,2,-2]:[2,-2,0,-1,1];b.setNum(c[b.qnum+2]),b.draw()}}},"KeyEvent@gokigen":{enablemake:!0,moveTarget:function(a){return this.moveTCross(a)},keyinput:function(a){this.key_inputcross(a)}},"KeyEvent@wagiri":{enablemake:!0,moveTarget:function(a){return this.moveTBorder(a)},keyinput:function(a){this.key_wagiri(a)},key_wagiri:function(a){var b=this.cursor;if(b.oncross())this.key_inputcross(a);else if(b.oncell()){var c=b.getc(),d=0;"1"===a?d=1:"2"===a?d=2:"-"===a?d=-2:" "===a&&(d=-1),c.isnull||0===d||(c.setNum(d),c.draw())}}},TargetCursor:{crosstype:!0},Cell:{setSideObj:function(){this.sideobj=[null,null],31===this.qans?this.sideobj=[this.relcross(-1,-1),this.relcross(1,1)]:32===this.qans&&(this.sideobj=[this.relcross(-1,1),this.relcross(1,-1)])}},Cross:{maxnum:4,minnum:0},Board:{cols:7,rows:7,disable_subclear:!0},BoardExec:{adjustBoardData:function(a,b){if(a&this.TURNFLIP)for(var c=this.board.cell,d=0;d<c.length;d++){var e=c[d];e.setQans({0:0,31:32,32:31}[e.qans])}}},LineGraph:{enabled:!0,relation:["cell"],pointgroup:"cross",linkgroup:"cell",rebuild2:function(){for(var a=this.board.cell,b=0;b<a.length;b++)a[b].setSideObj(),a[b].isloop=!1;pzpr.common.LineGraph.prototype.rebuild2.call(this)},isedgevalidbylinkobj:function(a){return a.qans>0},setCell:function(a){this.modifyNodes=[],null!==a.path&&this.removeEdgeByLinkObj(a),a.qans>0&&(a.setSideObj(),this.addEdgeByLinkObj(a)),this.remakeComponent()},setExtraData:function(a){pzpr.common.LineGraph.prototype.setExtraData.call(this,a);for(var b=a.getedgeobjs(),c=0;c<b.length;c++)b[c].isloop=!1;if(!(a.circuits<=0))for(var d,e=this.board,f=[a.nodes[0].obj],g={},h=e.maxbx-e.minbx+1;f.length>0;){var i=f[f.length-1],j=null,k=g[i.by*h+i.bx];if(void 0===k)k=g[i.by*h+i.bx]=f.length-1;else if("cross"===i.group&&f.length-1>k)for(var l=f.length-2;l>=0&&f[l]!==i;l--)"cell"===f[l].group&&(f[l].isloop=!0);if("cross"===i.group){d=i;for(var l=0;l<i.pathnodes[0].nodes.length;l++){var m=i.pathnodes[0].nodes[l].obj,n=e.getc(i.bx+m.bx>>1,i.by+m.by>>1);if(void 0===g[n.by*h+n.bx]){j=n;break}}}else for(var l=0;l<i.sideobj.length;l++){var o=i.sideobj[l];if(o!==d&&o!==f[f.length-2]){j=o;break}}j?f.push(j):f.pop()}}},Graphic:{irowake:!0,margin:.5,gridcolor_type:"DLIGHT",errcolor1:"red",errcolor2:"rgb(32, 32, 255)",crosssize:.33,paintRange:function(a,b,c,d){var e=this.board;!e.haserror&&this.puzzle.getConfig("autoerr")?this.setRange(e.minbx-2,e.minby-2,e.maxbx+2,e.maxby+2):this.setRange(a,b,c,d),this.prepaint()},paint:function(){this.drawBGCells(),this.drawDashedGrid(!1),"wagiri"===this.pid&&this.drawNumbers(),this.drawSlashes(),this.drawCrosses(),this.drawTarget()},getBGCellColor:function(a){return 0===a.qans&&1===a.error?this.errbcolor1:null},drawSlashes:function(){var a=this.puzzle,b=a.board;if(!b.haserror&&a.getConfig("autoerr")){var c=this.pid;b.cell.each(function(a){a.qinfo=a.isloop?"gokigen"===c?1:3:0}),this.common.drawSlashes.call(this),b.cell.setinfo(0)}else this.common.drawSlashes.call(this)},repaintLines:function(a){this.range.cells=a,this.drawSlashes(),this.context.use.canvas&&this.drawCrosses()}},"Graphic@wagiri":{drawNumber1:function(a){var b=this.context,c={"-2":"?",1:"輪",2:"切"}[a.qnum]||"";b.vid="cell_text_"+a.id,c?(b.fillStyle=this.fontcolor,this.disptext(c,a.bx*this.bw,a.by*this.bh,{ratio:[.7]})):b.vhide()},drawTarget:function(){var a=!this.puzzle.cursor.onborder();this.drawCursor(a,this.puzzle.editmode)}},"Encode@gokigen":{decodePzpr:function(a){var b=pzpr.parser,c=a===b.URL_PZPRAPP&&!this.checkpflag("c")||a===b.URL_PZPRV3&&this.checkpflag("d");c?this.decodecross_old():this.decode4Cross()},encodePzpr:function(a){a===pzpr.parser.URL_PZPRAPP&&(this.outpflag="c"),this.encode4Cross()}},"Encode@wagiri":{decodePzpr:function(a){this.decode4Cross(),this.decodeNumber10()},encodePzpr:function(a){this.encode4Cross(),this.encodeNumber10()}},FileIO:{decodeData:function(){this.decodeCrossNum(),"wagiri"===this.pid&&this.decodeCellQnum(),this.decodeCell(function(a,b){"1"===b?a.qans=31:"2"===b&&(a.qans=32)})},encodeData:function(){this.encodeCrossNum(),"wagiri"===this.pid&&this.encodeCellQnum(),this.encodeCell(function(a){return 31===a.qans?"1 ":32===a.qans?"2 ":". "})}},AnsCheck:{checklist:["checkSlashLoop","checkQnumCross","checkSlashNoLoop@wagiri","checkNoSlashCell+"],checkQnumCross:function(){for(var a=this.board,b=0;b<a.cross.length;b++){var c=a.cross[b],d=c.qnum;if(!(0>d||d===c.lcnt)){if(this.failcode.add("crConnSlNe"),this.checkOnly)break;c.seterr(1)}}},checkNoSlashCell:function(){this.checkAllCell(function(a){return 0===a.qans},"ceNoSlash")}},"AnsCheck@gokigen":{checkSlashLoop:function(){var a=this.board.cell.filter(function(a){return a.qans>0&&a.isloop});a.length>0&&(this.failcode.add("slLoop"),this.board.cell.setnoerr(),a.seterr(1))}},"AnsCheck@wagiri":{checkSlashLoop:function(){this.checkLoops_wagiri(!1,"slLoopGiri")},checkSlashNoLoop:function(){this.checkLoops_wagiri(!0,"slNotLoopWa")},checkLoops_wagiri:function(a,b){var c=a?function(a){return!a.isloop&&a.qans>0&&1===a.qnum}:function(a){return a.isloop&&a.qans>0&&2===a.qnum},d=this.board.cell.filter(c);d.length>0&&(this.failcode.add(b),this.board.cell.setnoerr(),d.seterr(1))}},FailCode:{slLoop:["斜線で輪っかができています。","There is a loop consisted in some slashes."],slLoopGiri:["'切'が含まれた線が輪っかになっています。","There is a loop that consists '切'."],slNotLoopWa:["'輪'が含まれた線が輪っかになっていません。","There is not a loop that consists '輪'."],crConnSlNe:["数字に繋がる線の数が間違っています。","A number is not equal to count of lines that is connected to it."],ceNoSlash:["斜線がないマスがあります。","There is an empty cell."]}});