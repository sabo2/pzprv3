/*! @license pzpr.js v3.6.0-pre (c) 2009-2016 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["toichika"],{MouseEvent:{mouseinput:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.btn.Left?this.inputarrow_cell():this.btn.Right&&this.inputDot():this.mouseend&&this.notInputted()&&this.inputqnum():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.isBorderMode()?this.inputborder():this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum())},inputDot:function(){var a=this.getcell();a.isnull||a===this.mouseCell||-1!==a.qnum||(null===this.inputData&&(this.inputData=1===a.qsub?0:1),a.setAnum(-1),a.setQsub(1===this.inputData?1:0),this.mouseCell=a,a.draw())}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return a.match(/shift/)?!1:this.moveTCell(a)},keyinput:function(a){this.key_toichika(a)},key_toichika:function(a){"1"===a||"w"===a||"shift+up"===a?a="1":"2"===a||"s"===a||"shift+right"===a?a="4":"3"===a||"z"===a||"shift+down"===a?a="2":"4"===a||"a"===a||"shift+left"===a?a="3":"5"===a||"q"===a||"-"===a?a="s1":("6"===a||"e"===a||" "===a)&&(a=" "),this.key_inputqnum(a)}},Cell:{numberAsObject:!0,maxnum:4},Board:{hasborder:1},BoardExec:{adjustBoardData:function(a,b){this.adjustCellArrow(a,b)}},AreaRoomGraph:{enabled:!0,getSideAreaKeys:function(){for(var a=this.components.length,b={len:a},c=this.board,d=0;a>d;d++)this.components[d].id=d;for(var e=0;e<c.border.length;e++){var f=c.border[e].sidecell[0],g=c.border[e].sidecell[1];if(!f.isnull&&!g.isnull){var h=f.room,i=g.room;if(h!==i&&null!==h&&null!==i){var j=h.id<i.id?h.id*a+i.id:i.id*a+h.id;b[j]||(b[j]=!0)}}}return b}},Graphic:{gridcolor_type:"LIGHT",dotcolor_type:"PINK",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawBorders(),this.drawDotCells(!0),this.drawCellArrows(),this.drawHatenas(),this.drawChassis(),this.drawCursor()}},Encode:{decodePzpr:function(a){this.decodeBorder(),this.decode4Cell_toichika()},encodePzpr:function(a){this.encodeBorder(),this.encode4Cell_toichika()},decode4Cell_toichika:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"1","4")?e.qnum=parseInt(c.substr(b,1),10):"."===f?e.qnum=-2:a+=parseInt(f,36)-5,a++,!d.cell[a])break}this.outbstr=c.substr(b)},encode4Cell_toichika:function(){for(var a="",b=0,c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qnum;-2===f?e=".":f>=1&&4>=f?e=f.toString(10):b++,0===b?a+=e:(e||31===b)&&(a+=(4+b).toString(36)+e,b=0)}b>0&&(a+=(4+b).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkDoubleNumber","checkAdjacentCountries","checkDirectionOfArrow","checkNoNumber"],checkDirectionOfArrow:function(){for(var a=this.getPairArrowsInfo(),b=0;b<a.length;b++)if(1===a[b].length){if(this.failcode.add("arAlone"),this.checkOnly)break;a[b][0].seterr(1)}},checkAdjacentCountries:function(){for(var a=this.board.roommgr.getSideAreaKeys(),b=a.len,c=this.getPairArrowsInfo(),d=0;d<c.length;d++)if(1!==c[d].length){var e=c[d][0].room,f=c[d][1].room,g=e.id<f.id?e.id*b+f.id:f.id*b+e.id;if(a[g]){if(this.failcode.add("arAdjPair"),this.checkOnly)break;e.clist.seterr(1),f.clist.seterr(1)}}},getPairArrowsInfo:function(){if(this._info.parrow)return this._info.parrow;for(var a=[],b=[],c=this.board,d=0;d<c.cell.length;d++)b[d]=c.cell[d].isNum();for(var d=0;d<c.cell.length;d++){var e=c.cell[d];if(!e.noNum())for(var f=e.getaddr(),g=e.getNum();;){f.movedir(g,2);var h=f.getc();if(h.isnull){a.push([e]);break}if(b[h.id]){h.getNum()!==[0,h.DN,h.UP,h.RT,h.LT][g]?a.push([e]):a.push([h,e]);break}}}return this._info.parrow=a}},FailCode:{bkNoNum:["国に矢印が入っていません。","A country has no arrow."],bkNumGe2:["1つの国に2つ以上の矢印が入っています。","A country has plural arrows."],arAdjPair:["辺を共有する国にペアとなる矢印が入っています。","There are paired arrows in adjacent countries."],arAlone:["矢印の先にペアとなる矢印がいません。","There is not paired arrow in the direction of an arrow."]}});