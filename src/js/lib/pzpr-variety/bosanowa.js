/*! @license pzpr.js v3.6.0-pre (c) 2009-2016 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.classmgr.makeCustom(["bosanowa"],{MouseEvent:{mouseinput:function(){this.mousestart&&this.inputqnum_bosanowa()},inputqnum_bosanowa:function(){var a=this.getpos(.31);a.isinside()&&(this.cursor.equals(a)?a.oncell()&&this.inputcell_bosanowa(a):this.setcursor(a))},inputcell_bosanowa:function(a){var b=a.getc();if(!b.isnull){var c=b.getmaxnum(),d=b.ques,e=b.getNum();this.puzzle.editmode&&(this.btn.Left?7===d?(b.setNum(-1),b.setQues(0)):-1===e?(b.setNum(1),b.setQues(0)):e===c?(b.setNum(-1),b.setQues(7)):b.setNum(e+1):this.btn.Right&&(7===d?(b.setNum(c),b.setQues(0)):1===e?(b.setNum(-1),b.setQues(0)):-1===e?(b.setNum(-1),b.setQues(7)):b.setNum(e-1))),this.puzzle.playmode&&0===d&&(this.btn.Left?e===c?b.setNum(-1):-1===e?b.setNum(1):b.setNum(e+1):this.btn.Right&&(-1===e?b.setNum(c):1===e?b.setNum(-1):b.setNum(e-1))),b.drawaround()}}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.moveTBorder(a)},keyinput:function(a){this.key_inputqnum_bosanowa(a)},key_inputqnum_bosanowa:function(a){var b=this.cursor;if(b.oncell()){var c=b.getc();if(this.puzzle.editmode)if("w"===a)c.setQues(7!==c.ques?7:0),c.setNum(-1);else if("-"===a||" "===a)c.setQues(0),c.setNum(-1);else{if(!(a>="0"&&"9">=a||"BS"===a))return;0!==c.ques&&(c.setQues(0),c.setNum(-1)),this.key_inputqnum(a)}else if(this.puzzle.playmode){if(0!==c.ques)return;this.key_inputqnum(a)}}else{if(!b.onborder())return;var d=b.getb();if(!d.isGrid())return;if(a>="0"&&"9">=a){var e=+a,f=d.qsub,g=99;0>=f||this.prev!==d?g>=e&&d.setQsub(e):g>=10*f+e?d.setQsub(10*f+e):g>=e&&d.setQsub(e),this.prev=d}else if("BS"===a){var e=d.qsub;10>e?d.setQsub(-1):d.setQsub(e/10|0)}else{if("-"!==a&&" "!==a)return;d.setQsub(-1)}}b.drawaround()}},TargetCursor:{initCursor:function(){var a=this.board;this.bx=(a.cols-1&-2)+1,this.by=(a.rows-1&-2)+1}},Cell:{ques:7},Border:{qsub:-1,isGrid:function(){return this.sidecell[0].isValid()&&this.sidecell[1].isValid()},isBorder:function(){return!!(this.sidecell[0].isEmpty()^this.sidecell[1].isEmpty())}},Board:{hasborder:2,initBoardSize:function(a,b){if(this.common.initBoardSize.call(this,a,b),!this.puzzle.playeronly){var c=this.puzzle.cursor.getc();c.isnull||(c.ques=0)}}},Graphic:{circleratio:[.47,.42],paint:function(){this.drawBGCells();var a=+this.puzzle.getConfig("disptype_bosanowa");1===a?(this.drawCircles(),this.drawBDnumbase()):2===a?(this.drawOutside_souko(),this.drawGrid_souko(),this.drawBDnumbase()):3===a&&(this.drawBorders(),this.drawGrid_waritai()),this.drawNumbers(),this.drawNumbersBD(),this.puzzle.playeronly||this.outputImage||this.drawChassis(),this.drawTarget_bosanowa()},getCanvasCols:function(){var a=this.puzzle.getConfig("disptype_bosanowa");return this.getBoardCols()+2*this.margin+(2===a?2:0)},getCanvasRows:function(){var a=this.puzzle.getConfig("disptype_bosanowa");return this.getBoardRows()+2*this.margin+(2===a?2:0)},drawErrorCells_bosanowa:function(){var a=this.vinc("cell_back","crispEdges",!0);a.fillStyle=this.errbcolor1;for(var b=this.range.cells,c=0;c<b.length;c++){var d=b[c];a.vid="c_fullerr_"+d.id,1===d.error?a.fillRectCenter(d.bx*this.bw,d.by*this.bh,this.bw,this.bh):a.vhide()}},getCircleStrokeColor:function(a){return a.isValid()&&!a.isNum()?1===a.error?this.errcolor1:this.quescolor:null},circlefillcolor_func:"null",drawGrid_souko:function(){var a=this.vinc("grid_souko","crispEdges",!0);a.lineWidth=1,a.strokeStyle="rgb(127,127,127)";for(var b=this.range.borders,c=0;c<b.length;c++){var d=b[c];if(a.vid="b_grids_"+d.id,d.isGrid()){var e=d.bx*this.bw,f=d.by*this.bh;if(d.isVert()){var g=f-this.bh,h=f+this.bh+1;a.strokeDashedLine(e,g,e,h,[3])}else{var i=e-this.bw,j=e+this.bw+1;a.strokeDashedLine(i,f,j,f,[3])}}else a.vhide()}},drawGrid_waritai:function(){for(var a=this.vinc("grid_waritai","crispEdges",!0),b=.2*this.cw,c=this.range.borders,d=0;d<c.length;d++){var e=c[d],f=e.isGrid(),g=e.bx*this.bw,h=e.by*this.bh;a.vid="b_grid_"+e.id,f?(a.fillStyle=this.gridcolor,e.isVert()?a.fillRectCenter(g,h,.5,this.bh):a.fillRectCenter(g,h,this.bw,.5)):a.vhide(),a.vid="b_grid2_"+e.id,f?(a.fillStyle=0===e.error?"white":this.errbcolor1,e.isVert()?a.fillRectCenter(g,h,.5,b):a.fillRectCenter(g,h,b,.5)):a.vhide()}},drawBDnumbase:function(){for(var a=this.vinc("border_number_base","crispEdges",!0),b=.2*this.cw,c=this.range.borders,d=0;d<c.length;d++){var e=c[d];a.vid="b_bbse_"+e.id,e.qsub>=0&&e.isGrid()?(a.fillStyle="white",a.fillRectCenter(e.bx*this.bw,e.by*this.bh,b,b)):a.vhide()}},drawNumbersBD:function(){for(var a=this.vinc("border_number","auto"),b={ratio:[.35]},c=this.range.borders,d=0;d<c.length;d++){var e=c[d];a.vid="border_text_"+e.id,e.qsub>=0?(a.fillStyle="blue",this.disptext(""+e.qsub,e.bx*this.bw,e.by*this.bh,b)):a.vhide()}},drawOutside_souko:function(){var a=this.vinc("cell_outside_souko","crispEdges",!0);a.fillStyle="rgb(127,127,127)";for(var b=this.range,c=b.x1-2|1;c<=b.x2+2;c+=2)for(var d=b.y1-2|1;d<=b.y2+2;d+=2){var e=new this.klass.Address(c,d);a.vid=["c_full_",c,d].join("_"),!e.getc().isEmpty()||0!==e.relcell(-2,0).ques&&0!==e.relcell(2,0).ques&&0!==e.relcell(0,-2).ques&&0!==e.relcell(0,2).ques&&0!==e.relcell(-2,-2).ques&&0!==e.relcell(2,-2).ques&&0!==e.relcell(-2,2).ques&&0!==e.relcell(2,2).ques?a.vhide():a.fillRectCenter(c*this.bw,d*this.bh,this.bw+.5,this.bh+.5)}},drawTarget_bosanowa:function(){var a=this.puzzle.cursor.oncell();this.drawCursor(a)}},Encode:{decodePzpr:function(a){this.decodeBoard(),this.decodeNumber16();var b=this.puzzle;this.checkpflag("h")?b.setConfig("disptype_bosanowa",2):this.checkpflag("t")&&b.setConfig("disptype_bosanowa",3)},encodePzpr:function(a){this.encodeBosanowa();var b=this.puzzle;2===b.getConfig("disptype_bosanowa")?this.outpflag="h":3===b.getConfig("disptype_bosanowa")&&(this.outpflag="t")},decodeBoard:function(){for(var a=this.outbstr,b=0,c=this.board,d=[16,8,4,2,1],e=0;e<a.length;e++){for(var f=parseInt(a.charAt(e),32),g=0;5>g;g++)c.cell[b]&&(c.cell[b].ques=f&d[g]?7:0,b++);if(!c.cell[b])break}this.outbstr=a.substr(e+1)},encodeBosanowa:function(a){for(var b=9999,c=-1,d=9999,e=-1,f=this.board,g=0;g<f.cell.length;g++){var h=f.cell[g];h.isEmpty()||(b>h.bx&&(b=h.bx),c<h.bx&&(c=h.bx),d>h.by&&(d=h.by),e<h.by&&(e=h.by))}for(var i="",j=0,k=0,l=[16,8,4,2,1],m=d;e>=m;m+=2)for(var n=b;c>=n;n+=2){var h=f.getc(n,m);h.isEmpty()&&(k+=l[j]),j++,5===j&&(i+=k.toString(32),j=0,k=0)}j>0&&(i+=k.toString(32)),this.outbstr+=i,i="",j=0;for(var m=d;e>=m;m+=2)for(var n=b;c>=n;n+=2){var o="",p=f.getc(n,m).qnum;-2===p?o=".":p>=0&&16>p?o=p.toString(16):p>=16&&256>p?o="-"+p.toString(16):j++,0===j?i+=o:(o||20===j)&&(i+=(15+j).toString(36)+o,j=0)}j>0&&(i+=(15+j).toString(36)),this.outbstr+=i,this.outcols=(c-b+2)/2,this.outrows=(e-d+2)/2}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){a.ques="."===b?7:0,"0"!==b&&"."!==b&&(a.qnum=+b)}),this.decodeCell(function(a,b){"0"!==b&&"."!==b&&(a.anum=+b)}),this.decodeBorder(function(a,b){"."!==b&&(a.qsub=+b)})},encodeData:function(){this.encodeCell(function(a){return 7===a.ques?". ":a.qnum>=0?a.qnum+" ":"0 "}),this.encodeCell(function(a){return 7===a.ques||-1!==a.qnum?". ":a.anum>=0?a.anum+" ":"0 "}),this.encodeBorder(function(a){return-1!==a.qsub?a.qsub+" ":". "})}},AnsCheck:{checklist:["checkSubsNumber","checkNoNumCell+"],checkSubsNumber:function(){for(var a=[],b=this.board,c=-1,d=0;d<b.border.length;d++){var e=b.border[d],f=e.sidecell[0],g=e.sidecell[1];e.isGrid()?f.isValidNum()&&g.isValidNum()?a[d]=Math.abs(f.getNum()-g.getNum()):a[d]=c:a[d]=null}for(var h=0;h<b.cell.length;h++){var i=b.cell[h];if(!i.isEmpty()&&!i.noNum()){var j,k=i.adjborder,l=i.getNum(),m=0;if(j=a[k.top.id],j>0)m+=j;else if(j===c)continue;if(j=a[k.bottom.id],j>0)m+=j;else if(j===c)continue;if(j=a[k.left.id],j>0)m+=j;else if(j===c)continue;if(j=a[k.right.id],j>0)m+=j;else if(j===c)continue;if(l!==m){if(this.failcode.add("nmSumOfDiff"),this.checkOnly)break;i.seterr(1)}}}}},FailCode:{nmSumOfDiff:["数字とその隣の数字の差の合計が合っていません。","Sum of the differences between the number and adjacent numbers is not equal to the number."]}});